#cloud-config
users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    lock_passwd: false
    plain_text_passwd: supersecret

# Enable password authentication
ssh_pwauth: true
password: supersecret
chpasswd:
  expire: false

# Ensure SSH service is enabled and started
runcmd:
  - systemctl enable ssh
  - systemctl start ssh
  - systemctl restart ssh

package_update: true
package_upgrade: true

packages:
  - openssh-server
  - clang
  - llvm
  - make
  - gcc
  - git
  - curl
  - wget
  - net-tools
  - qemu-guest-agent
  - ubuntu-drivers-common
  - linux-headers-generic

write_files:
  - path: /etc/ssh/sshd_config.d/99-packer.conf
    content: |
      PasswordAuthentication yes
      PermitRootLogin no
      PubkeyAuthentication yes
    permissions: '0644'
