#cloud-config
users:
  - name: ubuntu
    passwd: '$6$rounds=4096$saltsalt$hash'
    lock_passwd: false
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash

# Enable password authentication for SSH
ssh_pwauth: true
chpasswd:
  expire: false
  users:
    - name: ubuntu
      password: supersecret
      type: text

package_update: true
package_upgrade: true

packages:
  - clang
  - llvm
  - make
  - gcc
  - git
  - curl
  - wget
  - net-tools
  - qemu-guest-agent
  - ubuntu-drivers-common
  - linux-headers-generic

runcmd:
  - |
    set -e
    export DEBIAN_FRONTEND=noninteractive
    
    # Update package lists and install any available upgrades
    apt-get update
    apt-get upgrade -y

    # Autoinstall drivers
    ubuntu-drivers autoinstall
    
    # Enable and start essential services
    systemctl enable qemu-guest-agent
    systemctl start qemu-guest-agent
    
    # Set the default shell for the ubuntu user
    chsh -s /bin/bash ubuntu
    
    # Clean up apt cache to reduce image size
    apt-get clean
    
    # Update GRUB bootloader
    update-grub
