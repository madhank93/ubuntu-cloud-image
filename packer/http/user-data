#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: ubuntu-template
    username: ubuntu
  # Install with SSH enabled but passwords disabled for security
  ssh:
    install-server: yes
    allow-pw: no
    # PASTE YOUR TEMPORARY packer_key.pub CONTENTS HERE
    authorized-keys:
      - "ssh-ed25519 AAAAC3... packer-build-key"
  # Pre-install essential packages
  packages:
    - qemu-guest-agent
    - net-tools
    - ubuntu-drivers-common
  # Configure cloud-init to use NoCloud datasource for Proxmox compatibility
  late-commands:
    - |
      echo "datasource_list: [ NoCloud, ConfigDrive ]" > /target/etc/cloud/cloud.cfg.d/90_dpkg.cfg
